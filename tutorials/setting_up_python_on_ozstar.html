<!DOCTYPE html><html lang="en">
  <head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><title>Setting up Python on OzSTAR - Adam Batten</title>

<meta name="description" content="Getting Started with using Conda Environments on OzStarThis is a short guide on how to set up Python on OzSTAR, the supercomputer located at the Swinburne Un...">
<link rel="canonical" href="https://adambatten.com/tutorials/setting_up_python_on_ozstar.html"><link rel="alternate" type="application/rss+xml" title="Adam Batten" href="/feed.xml"><!-- start favicons snippet, use https://realfavicongenerator.net/<link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="manifest" href="/assets/site.webmanifest"><link rel="mask-icon" href="/assets/safari-pinned-tab.svg" color="#fc4d50"><link rel="shortcut icon" href="/assets/favicon.ico">

<meta name="msapplication-TileColor" content="#ffc40d"><meta name="msapplication-config" content="/assets/browserconfig.xml">

<meta name="theme-color" content="#ffffff">
 end favicons snippet -->

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#cccccc">
<meta name="theme-color" content="#cccccc">


<link rel="stylesheet" href="/assets/css/main.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.1/css/all.css" ><!-- start custom head snippets -->
<!-- end custom head snippets -->
<script>(function() {
  window.isArray = function(val) {
    return Object.prototype.toString.call(val) === '[object Array]';
  };
  window.isString = function(val) {
    return typeof val === 'string';
  };

  window.hasEvent = function(event) {
    return 'on'.concat(event) in window.document;
  };

  window.isOverallScroller = function(node) {
    return node === document.documentElement || node === document.body || node === window;
  };

  window.isFormElement = function(node) {
    var tagName = node.tagName;
    return tagName === 'INPUT' || tagName === 'SELECT' || tagName === 'TEXTAREA';
  };

  window.pageLoad = (function () {
    var loaded = false, cbs = [];
    window.addEventListener('load', function () {
      var i;
      loaded = true;
      if (cbs.length > 0) {
        for (i = 0; i < cbs.length; i++) {
          cbs[i]();
        }
      }
    });
    return {
      then: function(cb) {
        cb && (loaded ? cb() : (cbs.push(cb)));
      }
    };
  })();
})();
(function() {
  window.throttle = function(func, wait) {
    var args, result, thisArg, timeoutId, lastCalled = 0;

    function trailingCall() {
      lastCalled = new Date;
      timeoutId = null;
      result = func.apply(thisArg, args);
    }
    return function() {
      var now = new Date,
        remaining = wait - (now - lastCalled);

      args = arguments;
      thisArg = this;

      if (remaining <= 0) {
        clearTimeout(timeoutId);
        timeoutId = null;
        lastCalled = now;
        result = func.apply(thisArg, args);
      } else if (!timeoutId) {
        timeoutId = setTimeout(trailingCall, remaining);
      }
      return result;
    };
  };
})();
(function() {
  var Set = (function() {
    var add = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (data[i] === item) {
          return;
        }
      }
      this.size ++;
      data.push(item);
      return data;
    };

    var Set = function(data) {
      this.size = 0;
      this._data = [];
      var i;
      if (data.length > 0) {
        for (i = 0; i < data.length; i++) {
          add.call(this, data[i]);
        }
      }
    };
    Set.prototype.add = add;
    Set.prototype.get = function(index) { return this._data[index]; };
    Set.prototype.has = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (this.get(i) === item) {
          return true;
        }
      }
      return false;
    };
    Set.prototype.is = function(map) {
      if (map._data.length !== this._data.length) { return false; }
      var i, j, flag, tData = this._data, mData = map._data;
      for (i = 0; i < tData.length; i++) {
        for (flag = false, j = 0; j < mData.length; j++) {
          if (tData[i] === mData[j]) {
            flag = true;
            break;
          }
        }
        if (!flag) { return false; }
      }
      return true;
    };
    Set.prototype.values = function() {
      return this._data;
    };
    return Set;
  })();

  window.Lazyload = (function(doc) {
    var queue = {js: [], css: []}, sources = {js: {}, css: {}}, context = this;
    var createNode = function(name, attrs) {
      var node = doc.createElement(name), attr;
      for (attr in attrs) {
        if (attrs.hasOwnProperty(attr)) {
          node.setAttribute(attr, attrs[attr]);
        }
      }
      return node;
    };
    var end = function(type, url) {
      var s, q, qi, cbs, i, j, cur, val, flag;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        s[url] = true;
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (cur.urls.has(url)) {
            qi = cur, val = qi.urls.values();
            qi && (cbs = qi.callbacks);
            for (flag = true, j = 0; j < val.length; j++) {
              cur = val[j];
              if (!s[cur]) {
                flag = false;
              }
            }
            if (flag && cbs && cbs.length > 0) {
              for (j = 0; j < cbs.length; j++) {
                cbs[j].call(context);
              }
              qi.load = true;
            }
          }
        }
      }
    };
    var load = function(type, urls, callback) {
      var s, q, qi, node, i, cur,
        _urls = typeof urls === 'string' ? new Set([urls]) : new Set(urls), val, url;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (_urls.is(cur.urls)) {
            qi = cur;
            break;
          }
        }
        val = _urls.values();
        if (qi) {
          callback && (qi.load || qi.callbacks.push(callback));
          callback && (qi.load && callback());
        } else {
          q.push({
            urls: _urls,
            callbacks: callback ? [callback] : [],
            load: false
          });
          for (i = 0; i < val.length; i++) {
            node = null, url = val[i];
            if (s[url] === undefined) {
              (type === 'js' ) && (node = createNode('script', { src: url }));
              (type === 'css') && (node = createNode('link', { rel: 'stylesheet', href: url }));
              if (node) {
                node.onload = (function(type, url) {
                  return function() {
                    end(type, url);
                  };
                })(type, url);
                (doc.head || doc.body).appendChild(node);
                s[url] = false;
              }
            }
          }
        }
      }
    };
    return {
      js: function(url, callback) {
        load('js', url, callback);
      },
      css: function(url, callback) {
        load('css', url, callback);
      }
    };
  })(this.document);
})();
</script><script>
  (function() {
    var TEXT_VARIABLES = {
      version: '2.2.6',
      sources: {
        font_awesome: 'https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.1/css/all.css',
        jquery: 'https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js',
        leancloud_js_sdk: '//cdn.jsdelivr.net/npm/leancloud-storage@3.13.2/dist/av-min.js',
        chart: 'https://cdn.bootcss.com/Chart.js/2.7.2/Chart.bundle.min.js',
        gitalk: {
          js: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.js',
          css: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.css'
        },
        valine: 'https://unpkg.com/valine/dist/Valine.min.js',
        mathjax: 'https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML',
        mermaid: 'https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js'
      },
      site: {
        toc: {
          selectors: 'h1,h2,h3'
        }
      },
      paths: {
        search_js: '/assets/search.js'
      }
    };
    window.TEXT_VARIABLES = TEXT_VARIABLES;
  })();
</script>
</head>
  <body>
    <div class="root" data-is-touch="false">
      <div class="layout--page js-page-root"><div class="page__main js-page-main page__viewport has-aside cell cell--auto">

      <div class="page__main-inner"><div class="page__header d-print-none"><header class="header"><div class="main">
      <div class="header__title">
        <div class="header__brand"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
    xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:cc="http://creativecommons.org/ns#"
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
    id="svg2"
    sodipodi:docname="_svgclean2.svg"
    viewBox="0 0 168 156"
    version="1.1"
    inkscape:version="0.48.3.1 r9886"
  >
  <sodipodi:namedview
      id="namedview8"
      bordercolor="#666666"
      inkscape:pageshadow="2"
      guidetolerance="10"
      pagecolor="#ffffff"
      gridtolerance="10"
      inkscape:window-maximized="0"
      inkscape:zoom="0.22425739"
      objecttolerance="10"
      borderopacity="1"
      inkscape:current-layer="svg2"
      inkscape:cx="372.04724"
      inkscape:cy="-370.18109"
      inkscape:window-y="0"
      inkscape:window-x="0"
      inkscape:window-width="640"
      showgrid="false"
      inkscape:pageopacity="0"
      inkscape:window-height="480"
  />
  <path
      id="path4"
      inkscape:connector-curvature="0"
      d="m0 89c0-39.4 31.6-77 74-77 33.8 0 61 23.2 61 58 0 20.8-16.2 44-41 44-22 0-34-14-34-31-3.6 0-6 6-6 12 0 16.6 19.8 34 43 34 30.4 0 62-27.8 62-69 0-25.6-12.4-47-23-60 13 11 32 32.8 32 67 0 39.4-31.6 77-74 77-33.8 0-61-23.2-61-58 0-20.8 16.2-44 41-44 22 0 34 14 34 31 3.6 0 6-6 6-12 0-16.6-19.8-34-43-34-30.4 0-62 27.8-62 69 0 25.6 12.4 47 23 60-13-11-32-32.8-32-67z"
  />
  <metadata
      id="metadata6"
    >
    <rdf:RDF
      >
      <cc:Work
        >
        <dc:format
          >image/svg+xml</dc:format
        >
        <dc:type
            rdf:resource="http://purl.org/dc/dcmitype/StillImage"
        />
        <cc:license
            rdf:resource="http://creativecommons.org/licenses/publicdomain/"
        />
        <dc:publisher
          >
          <cc:Agent
              rdf:about="http://openclipart.org/"
            >
            <dc:title
              >Openclipart</dc:title
            >
          </cc:Agent
          >
        </dc:publisher
        >
      </cc:Work
      >
      <cc:License
          rdf:about="http://creativecommons.org/licenses/publicdomain/"
        >
        <cc:permits
            rdf:resource="http://creativecommons.org/ns#Reproduction"
        />
        <cc:permits
            rdf:resource="http://creativecommons.org/ns#Distribution"
        />
        <cc:permits
            rdf:resource="http://creativecommons.org/ns#DerivativeWorks"
        />
      </cc:License
      >
    </rdf:RDF
    >
  </metadata
  >
</svg
>
<a title="Personal Website
" href="/">Adam Batten</a></div></div><nav class="navigation">
        <ul><li class="navigation__item"><a href="/">Home</a></li><li class="navigation__item"><a href="/tutorials.html">Tutorials</a></li><li class="navigation__item"><a href="/outreach.html">Outreach</a></li></ul>
      </nav></div>
  </header>
</div><div class="page__content"><div class ="main"><div class="grid grid--reverse">

              <div class="col-aside d-print-none js-col-aside"><aside class="page__aside js-page-aside"><div class="toc-aside js-toc-root"></div>
</aside></div>

              <div class="col-main cell cell--auto"><!-- start custom main top snippet -->

<!-- end custom main top snippet -->
<article itemscope itemtype="http://schema.org/Article"><div class="article__header"><header><h1>Setting up Python on OzSTAR</h1></header></div><meta itemprop="headline" content="Setting up Python on OzSTAR"><div class="article__info clearfix"><ul class="left-col menu"><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=tutorial">tutorial</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=supercomputing">supercomputing</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=python">python</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=ozstar">ozstar</a>
            </li></ul><ul class="right-col menu"><li><i class="fas fa-user"></i> <span>Adam Batten</span></li><li><i class="far fa-calendar-alt"></i> <span>Feb 02, 2021</span>
            </li></ul></div><meta itemprop="author" content="Adam Batten"/><meta itemprop="datePublished" content="2021-02-02T00:00:00+11:00">
    <meta itemprop="keywords" content="tutorial,supercomputing,python,ozstar"><div class="js-article-content"><div class="layout--article"><!-- start custom article top snippet -->

<!-- end custom article top snippet -->
<div class="article__content" itemprop="articleBody"><h2 id="getting-started-with-using-conda-environments-on-ozstar">Getting Started with using Conda Environments on OzStar</h2>

<p>This is a short guide on how to set up Python on <a href="https://supercomputing.swin.edu.au/ozstar/">OzSTAR</a>, the supercomputer located at the <a href="https://www.swinburne.edu.au/">Swinburne University of Technology</a>. This will guide you through setting up <a href="https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html">Conda enviroments</a> and some of the pitfalls you may encounter along the way. Keep in mind this isn’t necessarly the ‘perfect’ way to use python on OzSTAR (since it really depends on your use case), but this tutorial is a good recommendation to get started for most people.</p>

<p>If you are unfamiliar with <a href="https://docs.conda.io/projects/conda/en/latest/user-guide/tasks/manage-environments.html">Conda environments</a> before this guide, they may feel a little different, but will make using Python on OzSTAR significantly easier in the long run.</p>

<p class="warning">Note: This is primarily aimed at people that will be using OzSTAR, and may not be applicable in other circumstances.</p>

<h3 id="this-tutorial-covers">This Tutorial Covers:</h3>
<ul>
  <li><a href="#preparation">Preparation</a></li>
  <li><a href="#loading-anaconda">Loading Anaconda</a></li>
  <li><a href="#using-conda-environments">Using Conda Environments</a>
    <ul>
      <li><a href="#why-use-a-conda-environment">Why Use a Conda Environment?</a></li>
      <li><a href="#creating-a-conda-environment">Creating a Conda Environment</a></li>
      <li><a href="#activate-a-conda-environment">Activate a Conda Environment</a></li>
      <li><a href="#deactivate-a-conda-environment">Deactivate a Conda Environment</a></li>
    </ul>
  </li>
  <li><a href="#issues-with-home-directory-quota">Issues With Home Directory Quota</a></li>
</ul>

<h3 id="this-tutorial-assumes-you-can">This Tutorial Assumes You Can:</h3>
<ul>
  <li>Log into OzSTAR</li>
  <li>Can edit a text file (specifically your <code class="language-plaintext highlighter-rouge">.bashrc</code> or <code class="language-plaintext highlighter-rouge">.bash_profile</code>)</li>
</ul>

<h3 id="some-key-definitions">Some Key Definitions:</h3>
<ul>
  <li><a href="https://www.anaconda.com/">Anaconda</a>: A distribution of python designed for scientific computing. By installing Python through Anaconda, it makes managing and installing Python packages/versions much easier. In particular, Anaconda has a useful feature called ‘<code class="language-plaintext highlighter-rouge">conda</code> environments’ which allows us to use different versions of Python or Python packages when we need to.</li>
  <li><code class="language-plaintext highlighter-rouge">conda</code>: A package and environment manger that is bundled with <a href="https://www.anaconda.com/">Anaconda</a>. It can install packages similar to how <code class="language-plaintext highlighter-rouge">pip</code> can install Python packages from <a href="https://pypi.org/">PyPI</a> using <code class="language-plaintext highlighter-rouge">conda install</code>. It can also create environments using <code class="language-plaintext highlighter-rouge">conda create</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">.bashrc</code>: This is a Bash shell script that runs whenever you launch an interactive shell. You can put any command(s) in a <code class="language-plaintext highlighter-rouge">.bashrc</code> that you would write at the command prompt. Then every time you launch a new interactive shell all the commands in the <code class="language-plaintext highlighter-rouge">.bashrc</code> will be executed. It is common practice to customise your <code class="language-plaintext highlighter-rouge">.bashrc</code> to include your own preferences (e.g. <a href="https://en.wikipedia.org/wiki/Alias_(command)">aliases</a> for specific commands that you type often). You can find your <code class="language-plaintext highlighter-rouge">.bashrc</code> in your home directory (<code class="language-plaintext highlighter-rouge">~/.bashrc</code>).</li>
  <li><code class="language-plaintext highlighter-rouge">PATH</code>: <code class="language-plaintext highlighter-rouge">PATH</code> is an environment variable that specifies a colection of directories where programs are located. This is list of directories are locations where programs can be started without having to type the entire path (e.g. <code class="language-plaintext highlighter-rouge">/User/username/subfolder/otherfolder/program.exe</code>). For example: to run Python you would normally just use the prefix <code class="language-plaintext highlighter-rouge">python</code>, without specifying where Python is located. This is because <code class="language-plaintext highlighter-rouge">python</code> is already the system <code class="language-plaintext highlighter-rouge">PATH</code>. If there are multiple directories in <code class="language-plaintext highlighter-rouge">PATH</code> that the required program, the one that will be used is the one that was added to the <code class="language-plaintext highlighter-rouge">PATH</code> the latest.</li>
</ul>

<h2 id="preparation">Preparation</h2>

<p>To get started, make sure that there is absolutely nothing related to Python environments currently found anywhere in your home directory or module lists.
This includes loading any of the OzSTAR Python modules (including Anaconda), like Python; <a href="https://numpy.org/">NumPy</a>; <a href="https://matplotlib.org/">Matplotlib</a>; etc, or having any conda installation (like <a href="https://www.anaconda.com/">Anaconda</a> and <a href="https://docs.conda.io/en/latest/miniconda.html">Miniconda</a>). 
Loading modules or libraries that are required by Python packages is fine.</p>

<p>You can ensure that all modules have been unloaded from your session use <code class="language-plaintext highlighter-rouge">module perge</code>.</p>

<p class="info">In case you are unfamiliar, OzSTAR uses modules to manage the software it has installed. If you want to use a module you first have to load it. To load a module use the following command: <code class="language-plaintext highlighter-rouge">module load &lt;module_name&gt;/&lt;software_version&gt;</code>.
You can search for modules using <code class="language-plaintext highlighter-rouge">module spider &lt;module_name&gt;</code>. To view a list of all the modules you have loaded use <code class="language-plaintext highlighter-rouge">module ls</code>.</p>

<h2 id="loading-anaconda">Loading Anaconda</h2>
<p>For managing Python on OzSTAR I suggest using Anaconda3 and <code class="language-plaintext highlighter-rouge">conda</code> environments.</p>

<p>Despite its name, Anaconda3 is can be used for both Python 3 and Python 2 (<a href="#python-3-vs-python-2">see warning about using Python 2</a>).
However Anaconda3 has the tendancy to overwrite the <code class="language-plaintext highlighter-rouge">PATH</code> to certain libraries that are used for Python packages. Examples of this include the HDF5-library <a href="https://h5py.org/">h5py</a> and the MPI-library <a href="https://mpi4py.readthedocs.io/en/stable/">mpi4py</a>. It is a good idea to use the system modules on OzSTAR (except for the system Python) as they are compiled and optimized for the OzStar architecture. Therefore if you have a list of system modules that need to be loaded, make sure to load <code class="language-plaintext highlighter-rouge">anaconda3</code> first so that the other modules will overide the <code class="language-plaintext highlighter-rouge">anaconda3</code> paths as they are loaded. Loading all modules after <code class="language-plaintext highlighter-rouge">anaconda3</code> means that those corresponding libraries are found earlier in the system <code class="language-plaintext highlighter-rouge">PATH</code> than <code class="language-plaintext highlighter-rouge">anaconda3</code>’s libraries. This ensures that everything is found in the correct place. To do this you can execute the following:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module purge
module load anaconda3/5.0.1
&lt;load other modules&gt;
</code></pre></div></div>
<p>The reason for using <code class="language-plaintext highlighter-rouge">module purge</code> all loaded modules first is to make absolutely sure that no paths are being overridden by <code class="language-plaintext highlighter-rouge">anaconda3</code>. I highly recommend using your <code class="language-plaintext highlighter-rouge">.bashrc</code> or <code class="language-plaintext highlighter-rouge">.bash_profile</code> for this, such that you don’t have to do it manually every time you login.</p>

<p class="warning">The reason for using <code class="language-plaintext highlighter-rouge">anaconda3/5.0.1</code> rather than <code class="language-plaintext highlighter-rouge">anaconda3/5.1.0</code> (which is also available on OzSTAR), is because the latter version has a bug where OzSTAR will not correctly set the paths to Anaconda’s commands (like <code class="language-plaintext highlighter-rouge">conda</code>; <code class="language-plaintext highlighter-rouge">activate</code>; <code class="language-plaintext highlighter-rouge">deactivate</code>). Instead, it attempts to use the ones from <code class="language-plaintext highlighter-rouge">anaconda3/5.0.1</code> whenever any environment besides the default is <a href="#activating-an-anaconda-environment">activated</a>. This means that it once an environment is <a href="#activating-an-anaconda-environment">activated</a> using <code class="language-plaintext highlighter-rouge">anaconda3/5.1.0</code>, it becomes impossible to <a href="#deactivate-an-anaconda-environment">deactivate</a> the environment again.</p>

<p><b>Example:</b></p>

<p>If everytime I want to log into OzSTAR I load the modules <code class="language-plaintext highlighter-rouge">anaconda3</code>, <code class="language-plaintext highlighter-rouge">openmpi</code>, <code class="language-plaintext highlighter-rouge">hdf5</code> and <code class="language-plaintext highlighter-rouge">git</code>, to avoid having to type these out every single time I put this code into my <code class="language-plaintext highlighter-rouge">.bashrc</code> file. Note that the <code class="language-plaintext highlighter-rouge">anaconda3/5.0.1</code> comes directly after <code class="language-plaintext highlighter-rouge">module purge</code>.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module purge
module load anaconda3/5.0.1
module load openmpi/3.0.0
module load hdf5/1.10.1
module load git/2.16.0
</code></pre></div></div>

<h2 id="using-conda-environments">Using Conda environments</h2>

<p class="success">TL;DR: Create custom environments using <code class="language-plaintext highlighter-rouge">conda create -n &lt;env_name&gt; python==&lt;python_version&gt;</code>, activate with <code class="language-plaintext highlighter-rouge">source activate &lt;environment_name&gt;</code> and deactivate with <code class="language-plaintext highlighter-rouge">source deactivate</code>.</p>

<h3 id="why-use-a-conda-environment">Why use a Conda Environment?</h3>
<p>The main purpose to using <code class="language-plaintext highlighter-rouge">conda</code> environments is to create an isolated environment for your project. This means you don’t have to worry about if different projects you are working on require different versions of software.</p>

<p>Say for example that you are writing some code for one of your projects. This project requires Python &gt; 3.5. However, in a different project at the same time you are using someone else’s software that is only compatible with <code class="language-plaintext highlighter-rouge">Python 2.7</code>, you really have five choices:</p>

<ol>
  <li>Uninstall and reinstall Python every single time you swap between the different software (<strong>tedious and not fun</strong>).</li>
  <li>Re-write the other software to be Python 3 compatible (<strong>also not fun</strong>).</li>
  <li>Re-write all your software to be compatible Python 2.7 compatible (<strong>not fun and will be more limited in features and support</strong>).</li>
  <li>Give up entirely (<strong>really really not fun</strong>).</li>
  <li>Use different <code class="language-plaintext highlighter-rouge">conda</code> environments to swap between Python 2.7 and Python 3 easily.</li>
</ol>

<h3 id="creating-a-conda-environment">Creating a Conda Environment</h3>

<p>The first rule about using a <code class="language-plaintext highlighter-rouge">conda</code> environment is NEVER use the base/default <code class="language-plaintext highlighter-rouge">conda</code> environment (i.e. the one that is activate with <code class="language-plaintext highlighter-rouge">source activate</code> with no additional arguments).
This environment is available to everyone that uses the same <code class="language-plaintext highlighter-rouge">anaconda3</code> module, and therefore cannot be used in a personal manner.
It also does not allow for packages to be installed globally (within the environment), which certain Python packages cannot deal with.
This is generally a good idea to avoid as well on personal computers.</p>

<p>So for this reason you will have to first create an new custom environment. A new environment can be created as follows:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>conda create -n &lt;environment_name&gt; python==&lt;python_version&gt;
</code></pre></div></div>
<p>This will create an environment with the name <code class="language-plaintext highlighter-rouge">&lt;environment_name&gt;</code> using Python version <code class="language-plaintext highlighter-rouge">&lt;python_version&gt;</code>. This environment will be stored in your <code class="language-plaintext highlighter-rouge">~/.conda/envs</code> directory. You can create multiple environments for the different versions of Python required. I personally have a <code class="language-plaintext highlighter-rouge">Python 3.8</code> environment for 99.9% of my work and <code class="language-plaintext highlighter-rouge">Python 2.7</code> environment to run software that hasn’t been update to <code class="language-plaintext highlighter-rouge">Python 3</code> yet.</p>

<p>If you dont know what to name your environment, I would suggest naming your environment either after the Python version. i.e If you are going to be using <code class="language-plaintext highlighter-rouge">Python 3.8</code>, name the environment <code class="language-plaintext highlighter-rouge">py38</code>, or you are using <code class="language-plaintext highlighter-rouge">Python 2.7</code> name it <code class="language-plaintext highlighter-rouge">py27</code>.</p>

<h3 id="activate-a-conda-environment">Activate a Conda Environment</h3>
<p>After the environment has been made, it can be activated with <code class="language-plaintext highlighter-rouge">source activate &lt;environment_name&gt;</code> (or <code class="language-plaintext highlighter-rouge">. activate &lt;environment_name&gt;</code>, either one is fine). You will be able to see that your environment is activated because the <code class="language-plaintext highlighter-rouge">&lt;environment_name&gt;</code> will appear on the left hand side of your prompt as shown below.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[~] conda activate py38
(py38) [~]
</code></pre></div></div>

<p>After you activate your environment, packages can be installed using <code class="language-plaintext highlighter-rouge">pip</code> or <code class="language-plaintext highlighter-rouge">conda</code> as normal without having to use the <code class="language-plaintext highlighter-rouge">--user</code> flag (which installs a package locally, but as environments are isolated, that is not necessary).</p>

<p>It’s also convenient to include the <code class="language-plaintext highlighter-rouge">source activate &lt;environment_name&gt;</code> in your <code class="language-plaintext highlighter-rouge">.bashrc</code> or <code class="language-plaintext highlighter-rouge">.bash_profile</code> so that your environment is automatically activated when you log into OzSTAR. For example, I have an environment called <code class="language-plaintext highlighter-rouge">py38</code> and my <code class="language-plaintext highlighter-rouge">.bashrc</code> contains this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module purge
module load anaconda3/5.0.1
source activate py38

module load openmpi/3.0.0
module load hdf5/1.10.1
module load git/2.16.0
</code></pre></div></div>

<h3 id="deactivate-a-conda-environment">Deactivate a Conda Environment</h3>
<p>To deactivate an active environment use <code class="language-plaintext highlighter-rouge">source deactivate</code> ( or <code class="language-plaintext highlighter-rouge">. deactivate</code>).</p>

<p>Keep a note of the <a href="#loading-anaconda">issue with deactivating environments</a> if you use <code class="language-plaintext highlighter-rouge">anaconda3/5.1.0</code>.</p>

<h2 id="issues-with-home-directory-quota">Issues with Home Directory Quota</h2>
<p class="success">TL;DR: If you are running out of inode space in your home directory, you can move your <code class="language-plaintext highlighter-rouge">.conda</code> to Lustre with <code class="language-plaintext highlighter-rouge">mv /home/&lt;username&gt;/.conda /fred/oz&lt;group_number&gt;/&lt;username&gt;</code> and make a symbolic link with <code class="language-plaintext highlighter-rouge">ln -s /fred/oz&lt;group_number&gt;/&lt;username&gt;/.conda /home/&lt;username&gt;/.conda</code></p>

<p>The main downside with using this approach to use Python on OzSTAR is that <code class="language-plaintext highlighter-rouge">conda</code> environments produce a large number of small files.
If you have many environments or large ones, it is possible that you will hit the file limit (aka inode limit) in your home directory (which is set to 100k).</p>

<p>A solution to this is to move the <code class="language-plaintext highlighter-rouge">.conda</code> folder to a project on Lustre (<code class="language-plaintext highlighter-rouge">/fred/</code>) and making a symbolic link between its location and your home directory.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mv /home/&lt;username&gt;/.conda /fred/oz&lt;group_number&gt;/&lt;username&gt;
ln -s /fred/oz&lt;group_number&gt;/&lt;username&gt;/.conda /home/&lt;username&gt;/.conda
</code></pre></div></div>

<p>This will allow you to use your environments anywhere as if they were still located in your home directory.
However keep in mind that Lustre is designed for long-term, big-file storage and therefore is not nearly as fast with reading as the home directories are.
This means that activating an environment or executing a script can take a while to start up (often about 30 seconds to 1 minute).
Once started, there are no speed differences as all required scripts and modules have now been loaded.
So in effect, the first Python script you run in your session will take about a minute longer to run, but the rest will be exactly the same.</p>

<h2 id="python-3-vs-python-2">Python 3 vs. Python 2</h2>
<p class="warning">It is advised that you should be using Python 3 for almost all of your projects. As of the 1st of January 2020, Python 2 is no longer supported. Meaning that packages like <a href="https://numpy.org/">NumPy</a>, <a href="https://matplotlib.org">Matplotlib</a>, <a href="https://scipy.org">SciPy</a> and <a href="https://astropy.org">Astropy</a> (plus more) will no longer update or fix issues with the Python 2 version of the software. If you absolutely need to use Python 2 for a specific project (e.g. legacy code that hasn’t been ported into Python 3 yet), you can set up a Python 2.7 environment and a Python 3 environment.</p>

<h2 id="acknowledgements">Acknowledgements</h2>
<p>A big thank to <a href="https://github.com/1313e/">Ellert van der Velden (@1313e)</a> who wrote the backbone of this tutorial in a text document one day on Slack and for useful feedback on my interpretation of the document that I have presented in this article.</p>

</div><section class="article__sharing d-print-none"></section><div class="d-print-none"><footer class="article__footer"><span>Last updated
      <time itemprop="dateModified" datetime="2021-02-02T00:00:00+11:00">Feb 02, 2021</time>
    </span><!-- start custom article footer snippet -->

<!-- end custom article footer snippet -->
<div itemscope itemtype="http://schema.org/Person" class="author-profile card card--flat item"><a href="https://adambatten.com" class="item__image"><img class="author-profile__avatar" itemprop="image" src="/assets/images/avatar.jpg" /></a><div class="item__content"><meta itemprop="name" content="Adam Batten">
        <p class="author-profile__name"><meta itemprop="url" content="https://adambatten.com">
            <a href="https://adambatten.com">Adam Batten</a></p><p itemprop="description">Astrophysics PhD Student | Science Communicator</p><div class="author-profile__links"><div class="author-links">
  <ul class="menu menu--nowrap menu--inline"><link itemprop="url" href="https://adambatten.com"><li title="Send me an Email.">
      <a class="button button--circle mail-button" itemprop="email" href="mailto:abatten@swin.edu.au" target="_blank">
        <i class="fas fa-envelope"></i>
      </a><li title="Follow me on Twitter.">
        <a class="button button--circle twitter-button" itemprop="sameAs" href="https://twitter.com/adamjbatten" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M1024.032 194.432c-37.664 16.704-78.176 28-120.672 33.088 43.36-26.016 76.672-67.168 92.384-116.224-40.608 24.064-85.568 41.568-133.408 50.976-38.336-40.832-92.928-66.336-153.344-66.336-116.032 0-210.08 94.048-210.08 210.08 0 16.48 1.856 32.512 5.44 47.872-174.592-8.768-329.408-92.416-433.024-219.52-18.08 31.04-28.448 67.104-28.448 105.632 0 72.896 37.088 137.184 93.472 174.88-34.432-1.088-66.816-10.528-95.168-26.272-0.032 0.864-0.032 1.76-0.032 2.656 0 101.792 72.416 186.688 168.512 205.984-17.632 4.8-36.192 7.36-55.36 7.36-13.536 0-26.688-1.312-39.52-3.776 26.72 83.456 104.32 144.192 196.256 145.888-71.904 56.352-162.496 89.92-260.928 89.92-16.96 0-33.664-0.992-50.112-2.944 92.96 59.616 203.392 94.4 322.048 94.4 386.432 0 597.728-320.128 597.728-597.76 0-9.12-0.192-18.176-0.608-27.168 41.056-29.632 76.672-66.624 104.832-108.736z" />
</svg>
</div>
        </a>
      </li><li title="Follow me on Linkedin.">
        <a class="button button--circle linkedin-button" itemprop="sameAs" href="https://www.linkedin.com/in/adamjbatten" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M260.096 155.648c0 27.307008-9.899008 50.516992-29.696 69.632-19.796992 19.115008-45.396992 28.672-76.8 28.672-30.036992 0-54.612992-9.556992-73.728-28.672-19.115008-19.115008-28.672-42.324992-28.672-69.632 0-28.672 9.556992-52.224 28.672-70.656 19.115008-18.432 44.372992-27.648 75.776-27.648 31.403008 0 56.32 9.216 74.752 27.648 18.432 18.432 28.331008 41.984 29.696 70.656 0 0 0 0 0 0m-202.752 808.96c0 0 0-632.832 0-632.832 0 0 196.608 0 196.608 0 0 0 0 632.832 0 632.832 0 0-196.608 0-196.608 0 0 0 0 0 0 0m313.344-430.08c0-58.708992-1.364992-126.292992-4.096-202.752 0 0 169.984 0 169.984 0 0 0 10.24 88.064 10.24 88.064 0 0 4.096 0 4.096 0 40.96-68.267008 105.812992-102.4 194.56-102.4 68.267008 0 123.220992 22.868992 164.864 68.608 41.643008 45.739008 62.464 113.664 62.464 203.776 0 0 0 374.784 0 374.784 0 0-196.608 0-196.608 0 0 0 0-350.208 0-350.208 0-91.476992-33.451008-137.216-100.352-137.216-47.787008 0-81.236992 24.576-100.352 73.728-4.096 8.192-6.144 24.576-6.144 49.152 0 0 0 364.544 0 364.544 0 0-198.656 0-198.656 0 0 0 0-430.08 0-430.08 0 0 0 0 0 0" />
</svg>
</div>
        </a>
      </li><li title="Follow me on Github.">
        <a class="button button--circle github-button" itemprop="sameAs" href="https://github.com/abatten" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path class="svgpath" data-index="path_0" fill="#272636" d="M0 525.2c0 223.6 143.3 413.7 343 483.5 26.9 6.8 22.8-12.4 22.8-25.4l0-88.7c-155.3 18.2-161.5-84.6-172-101.7-21.1-36-70.8-45.2-56-62.3 35.4-18.2 71.4 4.6 113.1 66.3 30.2 44.7 89.1 37.2 119 29.7 6.5-26.9 20.5-50.9 39.7-69.6C248.8 728.2 181.7 630 181.7 513.2c0-56.6 18.7-108.7 55.3-150.7-23.3-69.3 2.2-128.5 5.6-137.3 66.5-6 135.5 47.6 140.9 51.8 37.8-10.2 80.9-15.6 129.1-15.6 48.5 0 91.8 5.6 129.8 15.9 12.9-9.8 77-55.8 138.8-50.2 3.3 8.8 28.2 66.7 6.3 135 37.1 42.1 56 94.6 56 151.4 0 117-67.5 215.3-228.8 243.7 26.9 26.6 43.6 63.4 43.6 104.2l0 128.8c0.9 10.3 0 20.5 17.2 20.5C878.1 942.4 1024 750.9 1024 525.3c0-282.9-229.3-512-512-512C229.1 13.2 0 242.3 0 525.2L0 525.2z" />
</svg>
</div>
        </a>
      </li><li title="Find me on ORCID.">
        <a class="button button--circle orcid-button" itemprop="sameAs" href="https://orcid.org/0000-0001-7599-6488" target="_blank">
          <div class="icon"><i class="fab fa-orcid"></i></div>
        </a>
      </li></ul>
</div>
</div>

    </div>
</div>
</footer>
<div class="article__section-navigator clearfix"><div class="previous"><span>PREVIOUS</span><a href="/tutorials/submitting_jobs_on_ozstar.html">Submitting a Job on a Supercomputer</a></div></div></div>

</div>

<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    $(function() {
      var $this ,$scroll;
      var $articleContent = $('.js-article-content');
      var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
      var scroll = hasSidebar ? '.js-page-main' : 'html, body';
      $scroll = $(scroll);

      $articleContent.find('.highlight').each(function() {
        $this = $(this);
        $this.attr('data-lang', $this.find('code').attr('data-lang'));
      });
      $articleContent.find('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]').each(function() {
        $this = $(this);
        $this.append($('<a class="anchor d-print-none" aria-hidden="true"></a>').html('<i class="fas fa-anchor"></i>'));
      });
      $articleContent.on('click', '.anchor', function() {
        $scroll.scrollToAnchor('#' + $(this).parent().attr('id'), 400);
      });
    });
  });
})();
</script>
</div><section class="page__comments d-print-none"></section></article><!-- start custom main bottom snippet -->

<!-- end custom main bottom snippet -->
</div>
            </div></div></div><div class="page__footer d-print-none">
<footer class="footer py-4 js-page-footer">
  <div class="main"><div itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Adam Batten"><meta itemprop="url" content="https://adambatten.com"><meta itemprop="description" content="Astrophysics PhD Student | Science Communicator"><div class="footer__author-links"><div class="author-links">
  <ul class="menu menu--nowrap menu--inline"><link itemprop="url" href="https://adambatten.com"><li title="Send me an Email.">
      <a class="button button--circle mail-button" itemprop="email" href="mailto:abatten@swin.edu.au" target="_blank">
        <i class="fas fa-envelope"></i>
      </a><li title="Follow me on Twitter.">
        <a class="button button--circle twitter-button" itemprop="sameAs" href="https://twitter.com/adamjbatten" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M1024.032 194.432c-37.664 16.704-78.176 28-120.672 33.088 43.36-26.016 76.672-67.168 92.384-116.224-40.608 24.064-85.568 41.568-133.408 50.976-38.336-40.832-92.928-66.336-153.344-66.336-116.032 0-210.08 94.048-210.08 210.08 0 16.48 1.856 32.512 5.44 47.872-174.592-8.768-329.408-92.416-433.024-219.52-18.08 31.04-28.448 67.104-28.448 105.632 0 72.896 37.088 137.184 93.472 174.88-34.432-1.088-66.816-10.528-95.168-26.272-0.032 0.864-0.032 1.76-0.032 2.656 0 101.792 72.416 186.688 168.512 205.984-17.632 4.8-36.192 7.36-55.36 7.36-13.536 0-26.688-1.312-39.52-3.776 26.72 83.456 104.32 144.192 196.256 145.888-71.904 56.352-162.496 89.92-260.928 89.92-16.96 0-33.664-0.992-50.112-2.944 92.96 59.616 203.392 94.4 322.048 94.4 386.432 0 597.728-320.128 597.728-597.76 0-9.12-0.192-18.176-0.608-27.168 41.056-29.632 76.672-66.624 104.832-108.736z" />
</svg>
</div>
        </a>
      </li><li title="Follow me on Linkedin.">
        <a class="button button--circle linkedin-button" itemprop="sameAs" href="https://www.linkedin.com/in/adamjbatten" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M260.096 155.648c0 27.307008-9.899008 50.516992-29.696 69.632-19.796992 19.115008-45.396992 28.672-76.8 28.672-30.036992 0-54.612992-9.556992-73.728-28.672-19.115008-19.115008-28.672-42.324992-28.672-69.632 0-28.672 9.556992-52.224 28.672-70.656 19.115008-18.432 44.372992-27.648 75.776-27.648 31.403008 0 56.32 9.216 74.752 27.648 18.432 18.432 28.331008 41.984 29.696 70.656 0 0 0 0 0 0m-202.752 808.96c0 0 0-632.832 0-632.832 0 0 196.608 0 196.608 0 0 0 0 632.832 0 632.832 0 0-196.608 0-196.608 0 0 0 0 0 0 0m313.344-430.08c0-58.708992-1.364992-126.292992-4.096-202.752 0 0 169.984 0 169.984 0 0 0 10.24 88.064 10.24 88.064 0 0 4.096 0 4.096 0 40.96-68.267008 105.812992-102.4 194.56-102.4 68.267008 0 123.220992 22.868992 164.864 68.608 41.643008 45.739008 62.464 113.664 62.464 203.776 0 0 0 374.784 0 374.784 0 0-196.608 0-196.608 0 0 0 0-350.208 0-350.208 0-91.476992-33.451008-137.216-100.352-137.216-47.787008 0-81.236992 24.576-100.352 73.728-4.096 8.192-6.144 24.576-6.144 49.152 0 0 0 364.544 0 364.544 0 0-198.656 0-198.656 0 0 0 0-430.08 0-430.08 0 0 0 0 0 0" />
</svg>
</div>
        </a>
      </li><li title="Follow me on Github.">
        <a class="button button--circle github-button" itemprop="sameAs" href="https://github.com/abatten" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path class="svgpath" data-index="path_0" fill="#272636" d="M0 525.2c0 223.6 143.3 413.7 343 483.5 26.9 6.8 22.8-12.4 22.8-25.4l0-88.7c-155.3 18.2-161.5-84.6-172-101.7-21.1-36-70.8-45.2-56-62.3 35.4-18.2 71.4 4.6 113.1 66.3 30.2 44.7 89.1 37.2 119 29.7 6.5-26.9 20.5-50.9 39.7-69.6C248.8 728.2 181.7 630 181.7 513.2c0-56.6 18.7-108.7 55.3-150.7-23.3-69.3 2.2-128.5 5.6-137.3 66.5-6 135.5 47.6 140.9 51.8 37.8-10.2 80.9-15.6 129.1-15.6 48.5 0 91.8 5.6 129.8 15.9 12.9-9.8 77-55.8 138.8-50.2 3.3 8.8 28.2 66.7 6.3 135 37.1 42.1 56 94.6 56 151.4 0 117-67.5 215.3-228.8 243.7 26.9 26.6 43.6 63.4 43.6 104.2l0 128.8c0.9 10.3 0 20.5 17.2 20.5C878.1 942.4 1024 750.9 1024 525.3c0-282.9-229.3-512-512-512C229.1 13.2 0 242.3 0 525.2L0 525.2z" />
</svg>
</div>
        </a>
      </li><li title="Find me on ORCID.">
        <a class="button button--circle orcid-button" itemprop="sameAs" href="https://orcid.org/0000-0001-7599-6488" target="_blank">
          <div class="icon"><i class="fab fa-orcid"></i></div>
        </a>
      </li></ul>
</div>
</div>
    </div><div class="site-info mt-2">
      <div>© Adam Batten 2021,
        Powered by <a title="Jekyll is a simple, blog-aware, static site generator." href="http://jekyllrb.com/">Jekyll</a> & <a
        title="TeXt is a super customizable Jekyll theme." href="https://github.com/kitian616/jekyll-TeXt-theme">TeXt Theme</a>.
      </div>
    </div>
  </div>
</footer>
</div></div>
    </div><script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $body = $('body'), $window = $(window);
    var $pageRoot = $('.js-page-root'), $pageMain = $('.js-page-main');
    var activeCount = 0;
    function modal(options) {
      var $root = this, visible, onChange, hideWhenWindowScroll = false;
      var scrollTop;
      function setOptions(options) {
        var _options = options || {};
        visible = _options.initialVisible === undefined ? false : show;
        onChange = _options.onChange;
        hideWhenWindowScroll = _options.hideWhenWindowScroll;
      }
      function init() {
        setState(visible);
      }
      function setState(isShow) {
        if (isShow === visible) {
          return;
        }
        visible = isShow;
        if (visible) {
          activeCount++;
          scrollTop = $(window).scrollTop() || $pageMain.scrollTop();
          $root.addClass('modal--show');
          $pageMain.scrollTop(scrollTop);
          activeCount === 1 && ($pageRoot.addClass('show-modal'), $body.addClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.on('scroll', hide);
          $window.on('keyup', handleKeyup);
        } else {
          activeCount > 0 && activeCount--;
          $root.removeClass('modal--show');
          $window.scrollTop(scrollTop);
          activeCount === 0 && ($pageRoot.removeClass('show-modal'), $body.removeClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.off('scroll', hide);
          $window.off('keyup', handleKeyup);
        }
        onChange && onChange(visible);
      }
      function show() {
        setState(true);
      }
      function hide() {
        setState(false);
      }
      function handleKeyup(e) {
        // Char Code: 27  ESC
        if (e.which ===  27) {
          hide();
        }
      }
      setOptions(options);
      init();
      return {
        show: show,
        hide: hide,
        $el: $root
      };
    }
    $.fn.modal = modal;
  });
})();
</script><div class="modal modal--overflow page__search-modal d-print-none js-page-search-modal"></div></div>


<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function scrollToAnchor(anchor, duration, callback) {
      var $root = this;
      $root.animate({ scrollTop: $(anchor).position().top }, duration, function() {
        window.history.replaceState(null, '', window.location.href.split('#')[0] + anchor);
        callback && callback();
      });
    }
    $.fn.scrollToAnchor = scrollToAnchor;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function affix(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroll,
        offsetBottom = 0, scrollTarget = window, scroll = window.document, disabled = false, isOverallScroller = true,
        rootTop, rootLeft, rootHeight, scrollBottom, rootBottomTop,
        hasInit = false, curState;

      function setOptions(options) {
        var _options = options || {};
        _options.offsetBottom && (offsetBottom = _options.offsetBottom);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroll && (scroll = _options.scroll);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $scrollTarget = $(scrollTarget);
        isOverallScroller = window.isOverallScroller($scrollTarget[0]);
        $scroll = $(scroll);
      }
      function preCalc() {
        top();
        rootHeight = $root.outerHeight();
        rootTop = $root.offset().top + (isOverallScroller ? 0 :  $scrollTarget.scrollTop());
        rootLeft = $root.offset().left;
      }
      function calc(needPreCalc) {
        needPreCalc && preCalc();
        scrollBottom = $scroll.outerHeight() - offsetBottom - rootHeight;
        rootBottomTop = scrollBottom - rootTop;
      }
      function top() {
        if (curState !== 'top') {
          $root.removeClass('fixed').css({
            left: 0,
            top: 0
          });
          curState = 'top';
        }
      }
      function fixed() {
        if (curState !== 'fixed') {
          $root.addClass('fixed').css({
            left: rootLeft + 'px',
            top: 0
          });
          curState = 'fixed';
        }
      }
      function bottom() {
        if (curState !== 'bottom') {
          $root.removeClass('fixed').css({
            left: 0,
            top: rootBottomTop + 'px'
          });
          curState = 'bottom';
        }
      }
      function setState() {
        var scrollTop = $scrollTarget.scrollTop();
        if (scrollTop >= rootTop && scrollTop <= scrollBottom) {
          fixed();
        } else if (scrollTop < rootTop) {
          top();
        } else {
          bottom();
        }
      }
      function init() {
        if(!hasInit) {
          var interval, timeout;
          calc(true); setState();
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState();
          });
          $window.on('resize', function() {
            disabled || (calc(true), setState());
          });
          hasInit = true;
        }
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions,
        refresh: function() {
          calc(true, { animation: false }); setState();
        }
      };
    }
    $.fn.affix = affix;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function toc(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroller, $tocUl = $('<ul class="toc toc--ellipsis"></ul>'), $tocLi, $headings, $activeLast, $activeCur,
        selectors = 'h1,h2,h3', container = 'body', scrollTarget = window, scroller = 'html, body', disabled = false,
        headingsPos, scrolling = false, hasRendered = false, hasInit = false;

      function setOptions(options) {
        var _options = options || {};
        _options.selectors && (selectors = _options.selectors);
        _options.container && (container = _options.container);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroller && (scroller = _options.scroller);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $headings = $(container).find(selectors).filter('[id]');
        $scrollTarget = $(scrollTarget);
        $scroller = $(scroller);
      }
      function calc() {
        headingsPos = [];
        $headings.each(function() {
          headingsPos.push(Math.floor($(this).position().top));
        });
      }
      function setState(element, disabled) {
        var scrollTop = $scrollTarget.scrollTop(), i;
        if (disabled || !headingsPos || headingsPos.length < 1) { return; }
        if (element) {
          $activeCur = element;
        } else {
          for (i = 0; i < headingsPos.length; i++) {
            if (scrollTop >= headingsPos[i]) {
              $activeCur = $tocLi.eq(i);
            } else {
              $activeCur || ($activeCur = $tocLi.eq(i));
              break;
            }
          }
        }
        $activeLast && $activeLast.removeClass('active');
        ($activeLast = $activeCur).addClass('active');
      }
      function render() {
        if(!hasRendered) {
          $root.append($tocUl);
          $headings.each(function() {
            var $this = $(this);
            $tocUl.append($('<li></li>').addClass('toc-' + $this.prop('tagName').toLowerCase())
              .append($('<a></a>').text($this.text()).attr('href', '#' + $this.prop('id'))));
          });
          $tocLi = $tocUl.children('li');
          $tocUl.on('click', 'a', function(e) {
            e.preventDefault();
            var $this = $(this);
            scrolling = true;
            setState($this.parent());
            $scroller.scrollToAnchor($this.attr('href'), 400, function() {
              scrolling = false;
            });
          });
        }
        hasRendered = true;
      }
      function init() {
        var interval, timeout;
        if(!hasInit) {
          render(); calc(); setState(null, scrolling);
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState(null, scrolling);
          });
          $window.on('resize', window.throttle(function() {
            if (!disabled) {
              render(); calc(); setState(null, scrolling);
            }
          }, 100));
        }
        hasInit = true;
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions
      };
    }
    $.fn.toc = toc;
  });
})();
/*(function () {

})();*/
</script><script>
  /* toc must before affix, since affix need to konw toc' height. */(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  var TOC_SELECTOR = window.TEXT_VARIABLES.site.toc.selectors;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window);
    var $articleContent = $('.js-article-content');
    var $tocRoot = $('.js-toc-root'), $col2 = $('.js-col-aside');
    var toc;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
    var hasToc = $articleContent.find(TOC_SELECTOR).length > 0;

    function disabled() {
      return $col2.css('display') === 'none' || !hasToc;
    }

    tocDisabled = disabled();

    toc = $tocRoot.toc({
      selectors: TOC_SELECTOR,
      container: $articleContent,
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      tocDisabled = disabled();
      toc && toc.setOptions({
        disabled: tocDisabled
      });
    }, 100));

  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window), $pageFooter = $('.js-page-footer');
    var $pageAside = $('.js-page-aside');
    var affix;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');

    affix = $pageAside.affix({
      offsetBottom: $pageFooter.outerHeight(),
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      scroll: hasSidebar ? $('.js-page-main').children() : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      affix && affix.setOptions({
        disabled: tocDisabled
      });
    }, 100));

    window.pageAsideAffix = affix;
  });
})();
</script><script type="text/x-mathjax-config">
	var _config = { tex2jax: {
		inlineMath: [['$','$'], ['\\(','\\)']]
	}};MathJax.Hub.Config(_config);
</script>
<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML" async></script>

    </div>
    <script>(function () {
  var $root = document.getElementsByClassName('root')[0];
  if (window.hasEvent('touchstart')) {
    $root.dataset.isTouch = true;
    document.addEventListener('touchstart', function(){}, false);
  }
})();
</script>
  </body>
</html>

