<!DOCTYPE html><html lang="en">
  <head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><title>Submitting a Job on a Supercomputer - Adam Batten</title>

<meta name="description" content="A beginners guide to writing and submitting Slurm jobs on OzSTAR.Many students in the Centre of Astrophysics and Supercomputing at the Swinburne University o...">
<link rel="canonical" href="https://adambatten.com/tutorials/submitting_jobs_on_ozstar.html"><link rel="alternate" type="application/rss+xml" title="Adam Batten" href="/feed.xml"><!-- start favicons snippet, use https://realfavicongenerator.net/<link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="manifest" href="/assets/site.webmanifest"><link rel="mask-icon" href="/assets/safari-pinned-tab.svg" color="#fc4d50"><link rel="shortcut icon" href="/assets/favicon.ico">

<meta name="msapplication-TileColor" content="#ffc40d"><meta name="msapplication-config" content="/assets/browserconfig.xml">

<meta name="theme-color" content="#ffffff">
 end favicons snippet -->

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#cccccc">
<meta name="theme-color" content="#cccccc">


<link rel="stylesheet" href="/assets/css/main.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.1/css/all.css" ><!-- start custom head snippets -->
<!-- end custom head snippets -->
<script>(function() {
  window.isArray = function(val) {
    return Object.prototype.toString.call(val) === '[object Array]';
  };
  window.isString = function(val) {
    return typeof val === 'string';
  };

  window.hasEvent = function(event) {
    return 'on'.concat(event) in window.document;
  };

  window.isOverallScroller = function(node) {
    return node === document.documentElement || node === document.body || node === window;
  };

  window.isFormElement = function(node) {
    var tagName = node.tagName;
    return tagName === 'INPUT' || tagName === 'SELECT' || tagName === 'TEXTAREA';
  };

  window.pageLoad = (function () {
    var loaded = false, cbs = [];
    window.addEventListener('load', function () {
      var i;
      loaded = true;
      if (cbs.length > 0) {
        for (i = 0; i < cbs.length; i++) {
          cbs[i]();
        }
      }
    });
    return {
      then: function(cb) {
        cb && (loaded ? cb() : (cbs.push(cb)));
      }
    };
  })();
})();
(function() {
  window.throttle = function(func, wait) {
    var args, result, thisArg, timeoutId, lastCalled = 0;

    function trailingCall() {
      lastCalled = new Date;
      timeoutId = null;
      result = func.apply(thisArg, args);
    }
    return function() {
      var now = new Date,
        remaining = wait - (now - lastCalled);

      args = arguments;
      thisArg = this;

      if (remaining <= 0) {
        clearTimeout(timeoutId);
        timeoutId = null;
        lastCalled = now;
        result = func.apply(thisArg, args);
      } else if (!timeoutId) {
        timeoutId = setTimeout(trailingCall, remaining);
      }
      return result;
    };
  };
})();
(function() {
  var Set = (function() {
    var add = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (data[i] === item) {
          return;
        }
      }
      this.size ++;
      data.push(item);
      return data;
    };

    var Set = function(data) {
      this.size = 0;
      this._data = [];
      var i;
      if (data.length > 0) {
        for (i = 0; i < data.length; i++) {
          add.call(this, data[i]);
        }
      }
    };
    Set.prototype.add = add;
    Set.prototype.get = function(index) { return this._data[index]; };
    Set.prototype.has = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (this.get(i) === item) {
          return true;
        }
      }
      return false;
    };
    Set.prototype.is = function(map) {
      if (map._data.length !== this._data.length) { return false; }
      var i, j, flag, tData = this._data, mData = map._data;
      for (i = 0; i < tData.length; i++) {
        for (flag = false, j = 0; j < mData.length; j++) {
          if (tData[i] === mData[j]) {
            flag = true;
            break;
          }
        }
        if (!flag) { return false; }
      }
      return true;
    };
    Set.prototype.values = function() {
      return this._data;
    };
    return Set;
  })();

  window.Lazyload = (function(doc) {
    var queue = {js: [], css: []}, sources = {js: {}, css: {}}, context = this;
    var createNode = function(name, attrs) {
      var node = doc.createElement(name), attr;
      for (attr in attrs) {
        if (attrs.hasOwnProperty(attr)) {
          node.setAttribute(attr, attrs[attr]);
        }
      }
      return node;
    };
    var end = function(type, url) {
      var s, q, qi, cbs, i, j, cur, val, flag;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        s[url] = true;
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (cur.urls.has(url)) {
            qi = cur, val = qi.urls.values();
            qi && (cbs = qi.callbacks);
            for (flag = true, j = 0; j < val.length; j++) {
              cur = val[j];
              if (!s[cur]) {
                flag = false;
              }
            }
            if (flag && cbs && cbs.length > 0) {
              for (j = 0; j < cbs.length; j++) {
                cbs[j].call(context);
              }
              qi.load = true;
            }
          }
        }
      }
    };
    var load = function(type, urls, callback) {
      var s, q, qi, node, i, cur,
        _urls = typeof urls === 'string' ? new Set([urls]) : new Set(urls), val, url;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (_urls.is(cur.urls)) {
            qi = cur;
            break;
          }
        }
        val = _urls.values();
        if (qi) {
          callback && (qi.load || qi.callbacks.push(callback));
          callback && (qi.load && callback());
        } else {
          q.push({
            urls: _urls,
            callbacks: callback ? [callback] : [],
            load: false
          });
          for (i = 0; i < val.length; i++) {
            node = null, url = val[i];
            if (s[url] === undefined) {
              (type === 'js' ) && (node = createNode('script', { src: url }));
              (type === 'css') && (node = createNode('link', { rel: 'stylesheet', href: url }));
              if (node) {
                node.onload = (function(type, url) {
                  return function() {
                    end(type, url);
                  };
                })(type, url);
                (doc.head || doc.body).appendChild(node);
                s[url] = false;
              }
            }
          }
        }
      }
    };
    return {
      js: function(url, callback) {
        load('js', url, callback);
      },
      css: function(url, callback) {
        load('css', url, callback);
      }
    };
  })(this.document);
})();
</script><script>
  (function() {
    var TEXT_VARIABLES = {
      version: '2.2.6',
      sources: {
        font_awesome: 'https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.1/css/all.css',
        jquery: 'https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js',
        leancloud_js_sdk: '//cdn.jsdelivr.net/npm/leancloud-storage@3.13.2/dist/av-min.js',
        chart: 'https://cdn.bootcss.com/Chart.js/2.7.2/Chart.bundle.min.js',
        gitalk: {
          js: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.js',
          css: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.css'
        },
        valine: 'https://unpkg.com/valine/dist/Valine.min.js',
        mathjax: 'https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML',
        mermaid: 'https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js'
      },
      site: {
        toc: {
          selectors: 'h1,h2,h3'
        }
      },
      paths: {
        search_js: '/assets/search.js'
      }
    };
    window.TEXT_VARIABLES = TEXT_VARIABLES;
  })();
</script>
</head>
  <body>
    <div class="root" data-is-touch="false">
      <div class="layout--page js-page-root"><div class="page__main js-page-main page__viewport has-aside cell cell--auto">

      <div class="page__main-inner"><div class="page__header d-print-none"><header class="header"><div class="main">
      <div class="header__title">
        <div class="header__brand"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
    xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
    xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
    xmlns="http://www.w3.org/2000/svg"
    xmlns:cc="http://creativecommons.org/ns#"
    xmlns:dc="http://purl.org/dc/elements/1.1/"
    xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
    id="svg2"
    sodipodi:docname="_svgclean2.svg"
    viewBox="0 0 168 156"
    version="1.1"
    inkscape:version="0.48.3.1 r9886"
  >
  <sodipodi:namedview
      id="namedview8"
      bordercolor="#666666"
      inkscape:pageshadow="2"
      guidetolerance="10"
      pagecolor="#ffffff"
      gridtolerance="10"
      inkscape:window-maximized="0"
      inkscape:zoom="0.22425739"
      objecttolerance="10"
      borderopacity="1"
      inkscape:current-layer="svg2"
      inkscape:cx="372.04724"
      inkscape:cy="-370.18109"
      inkscape:window-y="0"
      inkscape:window-x="0"
      inkscape:window-width="640"
      showgrid="false"
      inkscape:pageopacity="0"
      inkscape:window-height="480"
  />
  <path
      id="path4"
      inkscape:connector-curvature="0"
      d="m0 89c0-39.4 31.6-77 74-77 33.8 0 61 23.2 61 58 0 20.8-16.2 44-41 44-22 0-34-14-34-31-3.6 0-6 6-6 12 0 16.6 19.8 34 43 34 30.4 0 62-27.8 62-69 0-25.6-12.4-47-23-60 13 11 32 32.8 32 67 0 39.4-31.6 77-74 77-33.8 0-61-23.2-61-58 0-20.8 16.2-44 41-44 22 0 34 14 34 31 3.6 0 6-6 6-12 0-16.6-19.8-34-43-34-30.4 0-62 27.8-62 69 0 25.6 12.4 47 23 60-13-11-32-32.8-32-67z"
  />
  <metadata
      id="metadata6"
    >
    <rdf:RDF
      >
      <cc:Work
        >
        <dc:format
          >image/svg+xml</dc:format
        >
        <dc:type
            rdf:resource="http://purl.org/dc/dcmitype/StillImage"
        />
        <cc:license
            rdf:resource="http://creativecommons.org/licenses/publicdomain/"
        />
        <dc:publisher
          >
          <cc:Agent
              rdf:about="http://openclipart.org/"
            >
            <dc:title
              >Openclipart</dc:title
            >
          </cc:Agent
          >
        </dc:publisher
        >
      </cc:Work
      >
      <cc:License
          rdf:about="http://creativecommons.org/licenses/publicdomain/"
        >
        <cc:permits
            rdf:resource="http://creativecommons.org/ns#Reproduction"
        />
        <cc:permits
            rdf:resource="http://creativecommons.org/ns#Distribution"
        />
        <cc:permits
            rdf:resource="http://creativecommons.org/ns#DerivativeWorks"
        />
      </cc:License
      >
    </rdf:RDF
    >
  </metadata
  >
</svg
>
<a title="Personal Website
" href="/">Adam Batten</a></div></div><nav class="navigation">
        <ul><li class="navigation__item"><a href="/">Home</a></li><li class="navigation__item"><a href="/tutorials.html">Tutorials</a></li><li class="navigation__item"><a href="/outreach.html">Outreach</a></li></ul>
      </nav></div>
  </header>
</div><div class="page__content"><div class ="main"><div class="grid grid--reverse">

              <div class="col-aside d-print-none js-col-aside"><aside class="page__aside js-page-aside"><div class="toc-aside js-toc-root"></div>
</aside></div>

              <div class="col-main cell cell--auto"><!-- start custom main top snippet -->

<!-- end custom main top snippet -->
<article itemscope itemtype="http://schema.org/Article"><div class="article__header"><header><h1>Submitting a Job on a Supercomputer</h1></header></div><meta itemprop="headline" content="Submitting a Job on a Supercomputer"><div class="article__info clearfix"><ul class="left-col menu"><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=tutorial">tutorial</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=supercomputing">supercomputing</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=slurm">slurm</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=ozstar">ozstar</a>
            </li></ul><ul class="right-col menu"><li><i class="fas fa-user"></i> <span>Adam Batten</span></li><li><i class="far fa-calendar-alt"></i> <span>Sep 08, 2020</span>
            </li></ul></div><meta itemprop="author" content="Adam Batten"/><meta itemprop="datePublished" content="2020-09-08T00:00:00+10:00">
    <meta itemprop="keywords" content="tutorial,supercomputing,slurm,ozstar"><div class="js-article-content"><div class="layout--article"><!-- start custom article top snippet -->

<!-- end custom article top snippet -->
<div class="article__content" itemprop="articleBody"><h2 id="a-beginners-guide-to-writing-and-submitting-slurm-jobs-on-ozstar">A beginners guide to writing and submitting Slurm jobs on OzSTAR.</h2>

<p>Many students in the <a href="https://astronomy.swin.edu.au/">Centre of Astrophysics and Supercomputing</a> at the <a href="https://www.swinburne.edu.au/">Swinburne University of Technology</a> have found it challenging to determine exactly what they need to do when they want to turn a program they have written into a job to OzSTAR. This tutorial aims to resolve this issue by giving detailed instructions so by the end, even complete OzSTAR beginners should understand how to write and submit their own jobs.</p>

<p>This tutorial for submitting jobs is primarily aimed at people who will be using the <a href="https://supercomputing.swin.edu.au/ozstar/">OzSTAR supercomputer</a> located at Swinburne. So keep in mind that some of this tutorial may not be applicable to all systems that are using a <a href="https://slurm.schedmd.com/overview.html">Slurm</a> based job scheduler. This tutorial is based on the OzSTAR/Slurm documentation found <a href="https://supercomputing.swin.edu.au/docs/2-ozstar/oz-slurm-create.html">here</a>.</p>

<h3 id="this-tutorial-covers">This Tutorial Covers:</h3>
<ul>
  <li><a href="#writing-a-job-submission-script">Writing a job submission script</a>.
    <ul>
      <li><a href="#1-the-shebang">The Shebang</a>.</li>
      <li><a href="#2-sbatch">#SBATCH</a>.</li>
      <li><a href="#3-loading-modules">Loading Modules</a>.</li>
      <li><a href="#4-job-step">Job Step</a>.</li>
    </ul>
  </li>
  <li><a href="#submitting-a-job-submission-script">Submitting a job submission script</a>.</li>
  <li><a href="#querying-the-state-of-a-job">Querying the state of a job</a>.</li>
  <li><a href="#canceling-a-job">Canceling a job</a>.</li>
  <li><a href="#examples">Example Job Submission Scripts</a>.</li>
</ul>

<h3 id="this-tutorial-assumes-you-can">This Tutorial Assumes You Can:</h3>
<ul>
  <li>Log into OzSTAR</li>
  <li>Write a shell script</li>
</ul>

<h3 id="some-key-definitions">Some Key Definitions:</h3>
<ul>
  <li><a href="https://slurm.schedmd.com/documentation.html">Slurm</a>: A job scheduler. When you submit a job, you are submitting it to Slurm. Slurm works to organise and schedule when all of the jobs will run after they have been submitted. Slurm determines the optimal way to allocate CPUs, time and memory to jobs based on what has been requested.</li>
</ul>

<h2 id="writing-and-submitting-a-job">Writing and Submitting A Job</h2>
<p>Submitting a job on OzSTAR is a two step process:</p>

<p>1) First you have to request resources from OzSTAR. This will normally include the amount of memory you need, the number of CPUs you want to use and how long you expect to be using the resources. This step is called a ‘‘resource request”. An example resource request using english could be: 
<em><center>"I want to use 200 MB of memory on 1 CPU core for 2 hours".</center></em></p>

<p>2) The second step is where you say what you want these resources to be doing. This includes specifying what software is needed, which scripts you want to run, and how to execute them. This step is called the ‘job step’. An example job step could be:</p>

<p><em><center>"I want to load python and then execute a python script".</center></em></p>

<p>Luckily, you can do both of these steps at the same time using a “submission script”.</p>

<h3 id="writing-a-job-submission-script">Writing a Job Submission Script</h3>
<p>A submission script is just a shell script that is formatted in a specific way such that it contains both your resource request and your job step. 
Here is an example of a simple submission script called <code class="language-plaintext highlighter-rouge">my_slurm_job.sh</code>. This submission script will run a python script called <code class="language-plaintext highlighter-rouge">example_python_job.py</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/bash

#SBATCH --ntasks=1
#SBATCH --mem=100MB
#SBATCH --time=00:30:00

module purge
module load anaconda3/5.0.1

source activate py3

python example_python_job.py
</code></pre></div></div>

<p>There are four main components to a submission script: <a href="#1-the-shebang">The Shebang</a>, <a href="#2-sbatch">#SBATCH</a>, <a href="#3-loading-modules">Loading Modules</a> and <a href="#4-job-step">The Job Step</a>.</p>
<h3 id="1-the-shebang">1 The Shebang</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/bash 
</code></pre></div></div>

<p>The first component is the very first line: <code class="language-plaintext highlighter-rouge">#!/bin/bash</code>. This line has many names including: ‘shebang’, ‘shabang’, ‘hashbang’, ‘pound-bang’, ‘hash-pling’ and probably lots of other ridiculous sounding names. This line serves the purpose of defining which ‘interpreter’ to use when executing the script.</p>

<p>In this case we are effectively saying:  “This is a bash (Bourne-Again Shell) script, so execute this script with a bash shell”.</p>

<p>Since all of your submission scripts will be likely be a bash script, this line will be the same for every submission script you write.</p>

<h3 id="2-sbatch">2 #SBATCH</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#SBATCH --ntasks=1
#SBATCH --mem=100MB
#SBATCH --time=00:30:00
</code></pre></div></div>

<p>The second component is where you request resources and it includes all the lines that start with <code class="language-plaintext highlighter-rouge">#SBATCH</code>. Any line in your submission script that begins with <code class="language-plaintext highlighter-rouge">#SBATCH</code> is understood by Slurm to be a resource request or an additional option related to the job.</p>

<p class="warning">Notice the # in front. This can be easy to forget but is important.</p>

<p>In this example script we are requesting: 1 CPU (<code class="language-plaintext highlighter-rouge">#SBATCH --ntasks=1</code>) and 100 MB of RAM (<code class="language-plaintext highlighter-rouge">#SBATCH --mem=100MB</code>) for 30 minutes (<code class="language-plaintext highlighter-rouge">#SBATCH --time=00:30:00</code>).
Similarly if you wanted request 2 GB of RAM on a single CPU for 12 hours your resource request would look like this:</p>

<p><b>Example</b></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#SBATCH --ntasks=1
#SBATCH --mem=2GB
#SBATCH --time=12:00:00
</code></pre></div></div>

<p>There are lots of additional options that you include here, for instance you can include the option to have SLURM send you an email when your job starts and ends.</p>

<p><b>Example:</b></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#SBATCH --mail-user=name@swin.edu.au
#SBATCH --mail-type=ALL
</code></pre></div></div>
<p>You can see a complete list of parameters using <code class="language-plaintext highlighter-rouge">man sbatch</code>. I have also listed more examples of options that may be useful at the end of this tutorial.</p>

<p class="info">A good rule of thumb is: The more resources you request, the longer it will take for your job to start. 
This means that asking for way more time and RAM than you actually need is not a good idea. 
Unfortunately, this tutorial can not tell you how much resources your job will require. 
You will have have to determine that for yourself. 
If you are using python, you can look into using packages such as <a href="https://github.com/pythonprofilers/memory_profiler">memory_profiler</a> and <a href="https://github.com/pyutils/line_profiler">line_profiler</a> to help estimate the memory usage and timing of a script.</p>

<h3 id="3-loading-modules">3 Loading Modules</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>module purge
module load anaconda3/5.0.1

source activate py3
</code></pre></div></div>

<p>The third component is where you load all the modules that are necessary to run your script. OzSTAR uses modules to manage the software it has installed. If you want to use a module you first have to load it. To load a module use the following command: <code class="language-plaintext highlighter-rouge">module load &lt;module_name&gt;/&lt;software_version&gt;</code>. You can search for modules using <code class="language-plaintext highlighter-rouge">module spider &lt;module_name&gt;</code>. We will be executing a python script using the example submission script, hence we have to load the modules for anaconda and the Conda environment that all the packages are install in.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">module purge</code> unloads all loaded modules.</li>
  <li><code class="language-plaintext highlighter-rouge">module load anaconda3/5.0.1</code> loads Anaconda. I recommend using the <code class="language-plaintext highlighter-rouge">anaconda3/5.0.1</code> version of instead of <code class="language-plaintext highlighter-rouge">anaconda3/5.1.0</code> because there is a significant bug in the later version on OzSTAR related to Conda environments.</li>
  <li><code class="language-plaintext highlighter-rouge">source activate py3</code> loads a Conda environment that I have called <code class="language-plaintext highlighter-rouge">py3</code>. In this environment I have installed all of the necessary packages required to execute <code class="language-plaintext highlighter-rouge">example_python_job.py</code>.</li>
</ul>

<p>Here is a list of a few common modules that you might need to load: <code class="language-plaintext highlighter-rouge">gcc/7.3.0</code>, <code class="language-plaintext highlighter-rouge">hdf5/1.10.1</code>, <code class="language-plaintext highlighter-rouge">openmpi/3.0.0</code>.</p>

<p class="info">Loading modules is not necessary if they are already loaded in your session. 
You can load modules in the <code>.bashrc</code> file in your home directory the same way you would load them in a bash script.
If you load modules in your <code>.bashrc</code> those modules will automatically get loaded into your environment every time you log into Ozstar. This means you only have to write <code>load module anaconda3/5.0.1</code> once in your <code>.bashrc</code> and then forget about it.</p>

<p class="info">If you are using python I highly recommend that you use Conda environments when working on OzSTAR. Anaconda environments will save you lots of time, stress and effort in the long run.</p>

<h3 id="4-job-step">4 Job Step</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python example_python_job.py
</code></pre></div></div>
<p>This final component is where you say what you want to actually run on the requested resources. This is the job step. In the example, we have a single line <code class="language-plaintext highlighter-rouge">python example_python_job.py</code> indicating that our job will run the <code class="language-plaintext highlighter-rouge">example_python_job.py</code> script. It is also possible to list multiple job steps in a submission script and they will be performed one after another.</p>

<p><b>Example:</b></p>
<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python example_python_job.py
python example_python_job2.py
python_example_python_job3.py
</code></pre></div></div>
<p>In this case, after the first job step is completed the second job step (<code class="language-plaintext highlighter-rouge">example_python_job2.py</code>) will begin. In your resource request you will have to allow for the time and memory requirements for all of the job steps.</p>

<h3 id="submitting-a-job-submission-script">Submitting a Job Submission Script</h3>

<p>After you have finished writing a submission script, you can submit it to Slurm with the <code class="language-plaintext highlighter-rouge">sbatch</code> command.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; sbatch my_slurm_job.sh
sbatch: Submitted batch job 99999999
</code></pre></div></div>

<p>If the job is successfully submitted, it will respond with the <code class="language-plaintext highlighter-rouge">jobid</code> that was assigned to the job. In this example the <code class="language-plaintext highlighter-rouge">jobid</code> is 99999999.</p>

<p class="info">You can also submit a job to the queue from within a submission script. This can be useful for automating a pipeline of scripts that need to be completed in a sequence.</p>

<p>You can find more documentaion related to the <code class="language-plaintext highlighter-rouge">sbatch</code> command on the official Slurm website <a href="https://slurm.schedmd.com/sbatch.html">here</a>.</p>

<h2 id="querying-the-state-of-a-job">Querying the State of a Job</h2>

<p>You can find out about the state of your job and all other jobs in the queue using the command <code class="language-plaintext highlighter-rouge">squeue</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; squeue --user=yourusername
</code></pre></div></div>
<p>This will give you the status of all your running and submitted jobs.
You can also neglect the <code class="language-plaintext highlighter-rouge">--user=yourusername</code> to view the entire job queue for all users.</p>

<p>If you are using OzSTAR then the output of <code class="language-plaintext highlighter-rouge">squeue --user=yourusername</code> should look similar to the figure below.</p>

<p><img src="/assets/images/slurm_squeue.png" alt="&quot;An image of the output of squeue after using sbatch on my_slurm_job.sh&quot;" /></p>

<p>The columns of the output are as follows:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">JOBID</code>: The JOBID that is given to the job. This ID is unique amongst all jobs past, present and future.</li>
  <li><code class="language-plaintext highlighter-rouge">PARTITION</code>: The type of ‘queue’ that the job is in. This is usually given by the name of the type of CPU that will be running the job.</li>
  <li><code class="language-plaintext highlighter-rouge">NAME</code>: The name of the job.</li>
  <li><code class="language-plaintext highlighter-rouge">USER</code>: The username of the person that submitted the job.</li>
  <li><code class="language-plaintext highlighter-rouge">ST</code>: The status of the job.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">R</code>: Currently Running</li>
      <li><code class="language-plaintext highlighter-rouge">PD</code>: Waiting for Resources (Pending)</li>
    </ul>
  </li>
  <li><code class="language-plaintext highlighter-rouge">TIME</code>: The length of time the job has been running. If the job is pending (<code class="language-plaintext highlighter-rouge">ST = PD</code>) it will say <code class="language-plaintext highlighter-rouge">0:00</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">NODES</code>: The number of ‘nodes’ that the job has requested. A ‘node’ is a collection of many CPUs. OzSTAR has a few different types of nodes with different amounts of CPUs on each. For example the <code class="language-plaintext highlighter-rouge">john</code> (<code class="language-plaintext highlighter-rouge">PARTITION = skylake</code>) nodes have 32 CPUs each.</li>
  <li><code class="language-plaintext highlighter-rouge">NODELIST(REASON)</code>: If the job is currently running (<code class="language-plaintext highlighter-rouge">ST = R</code>) this is the list of nodes that the job is using. If the job is pending (<code class="language-plaintext highlighter-rouge">ST = PD</code>) this is why the job is pending.</li>
</ul>

<p>You can also use the <a href="https://supercomputing.swin.edu.au/monitor/">OzSTAR Job Monitor Website</a> for a graphical view of all the jobs that are running and in the queue.</p>

<h2 id="canceling-a-job">Canceling a Job</h2>
<p>Sometimes you will have a job that you need to cancel for some reason. You can cancel a running or submitted job at any time with <code class="language-plaintext highlighter-rouge">scancel jobid</code>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&gt;&gt;&gt; scancel 99999999
</code></pre></div></div>

<p>You can also cancel all of your jobs with <code class="language-plaintext highlighter-rouge">scancel --user=yourusername</code> or you can only cancel your “Pending” jobs with <code class="language-plaintext highlighter-rouge">scancel -t PD</code>.</p>

<h2 id="examples">Examples</h2>

<h4 id="example-0">Example 0</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/bash

#SBATCH --ntasks=1
#SBATCH --mem=100MB
#SBATCH --time=00:30:00

module purge
module load anaconda3/5.0.1

source activate py3

python example_python_job.py
</code></pre></div></div>
<p>This is the same example as shown throughout this tutorial.</p>

<h4 id="example-1">Example 1</h4>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/bash

#SBATCH --ntasks=1
#SBATCH --mem=100MB
#SBATCH --time=00:30:00

#SBATCH --job-name=Calculate_Mean
#SBATCH --output=slurm_output.txt

#SBATCH --mail-user=name@swin.edu.au
#SBATCH --mail-type=ALL
#SBATCH --account=oz999

module purge
module load anaconda3/5.0.1

source activate py3

python example_python_job.py
</code></pre></div></div>
<p>This is essentially the same as <a href="#example-0">Example 0</a> but with a few additional parameters.</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">--job-name</code> is being used to give a more meaningful name to the job.
This is the name that will show up as <code class="language-plaintext highlighter-rouge">NAME</code> when using <code class="language-plaintext highlighter-rouge">squeue</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">--output</code> is defining the file that all of the Slurm output (i.e. print statements) will be directed.</li>
  <li><code class="language-plaintext highlighter-rouge">--mail-user</code> and <code class="language-plaintext highlighter-rouge">--main-type</code> makes Slurm send an email when your job starts and completes.</li>
  <li><code class="language-plaintext highlighter-rouge">--account</code> is setting which group account this job belongs is associated with.</li>
</ul>

<h3 id="summary">Summary</h3>
<p>This tutorial is not meant as a comprehensive article covering all there is to know about using Slurm. Still, hopefully by now you feel confident enough to be able to write you own bash scripts and get jobs running on OzSTAR.</p>

<h3 id="acknowledgements">Acknowledgements</h3>
<p>Thank you to <a href="https://github.com/1313e/">Ellert van der Velden (@1313e)</a> for useful feedback on the draft of this article.</p>

</div><section class="article__sharing d-print-none"></section><div class="d-print-none"><footer class="article__footer"><span>Last updated
      <time itemprop="dateModified" datetime="2021-01-26T00:00:00+11:00">Jan 26, 2021</time>
    </span><!-- start custom article footer snippet -->

<!-- end custom article footer snippet -->
<div itemscope itemtype="http://schema.org/Person" class="author-profile card card--flat item"><a href="https://adambatten.com" class="item__image"><img class="author-profile__avatar" itemprop="image" src="/assets/images/avatar.jpg" /></a><div class="item__content"><meta itemprop="name" content="Adam Batten">
        <p class="author-profile__name"><meta itemprop="url" content="https://adambatten.com">
            <a href="https://adambatten.com">Adam Batten</a></p><p itemprop="description">Astrophysics PhD Student | Science Communicator</p><div class="author-profile__links"><div class="author-links">
  <ul class="menu menu--nowrap menu--inline"><link itemprop="url" href="https://adambatten.com"><li title="Send me an Email.">
      <a class="button button--circle mail-button" itemprop="email" href="mailto:abatten@swin.edu.au" target="_blank">
        <i class="fas fa-envelope"></i>
      </a><li title="Follow me on Twitter.">
        <a class="button button--circle twitter-button" itemprop="sameAs" href="https://twitter.com/adamjbatten" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M1024.032 194.432c-37.664 16.704-78.176 28-120.672 33.088 43.36-26.016 76.672-67.168 92.384-116.224-40.608 24.064-85.568 41.568-133.408 50.976-38.336-40.832-92.928-66.336-153.344-66.336-116.032 0-210.08 94.048-210.08 210.08 0 16.48 1.856 32.512 5.44 47.872-174.592-8.768-329.408-92.416-433.024-219.52-18.08 31.04-28.448 67.104-28.448 105.632 0 72.896 37.088 137.184 93.472 174.88-34.432-1.088-66.816-10.528-95.168-26.272-0.032 0.864-0.032 1.76-0.032 2.656 0 101.792 72.416 186.688 168.512 205.984-17.632 4.8-36.192 7.36-55.36 7.36-13.536 0-26.688-1.312-39.52-3.776 26.72 83.456 104.32 144.192 196.256 145.888-71.904 56.352-162.496 89.92-260.928 89.92-16.96 0-33.664-0.992-50.112-2.944 92.96 59.616 203.392 94.4 322.048 94.4 386.432 0 597.728-320.128 597.728-597.76 0-9.12-0.192-18.176-0.608-27.168 41.056-29.632 76.672-66.624 104.832-108.736z" />
</svg>
</div>
        </a>
      </li><li title="Follow me on Linkedin.">
        <a class="button button--circle linkedin-button" itemprop="sameAs" href="https://www.linkedin.com/in/adamjbatten" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M260.096 155.648c0 27.307008-9.899008 50.516992-29.696 69.632-19.796992 19.115008-45.396992 28.672-76.8 28.672-30.036992 0-54.612992-9.556992-73.728-28.672-19.115008-19.115008-28.672-42.324992-28.672-69.632 0-28.672 9.556992-52.224 28.672-70.656 19.115008-18.432 44.372992-27.648 75.776-27.648 31.403008 0 56.32 9.216 74.752 27.648 18.432 18.432 28.331008 41.984 29.696 70.656 0 0 0 0 0 0m-202.752 808.96c0 0 0-632.832 0-632.832 0 0 196.608 0 196.608 0 0 0 0 632.832 0 632.832 0 0-196.608 0-196.608 0 0 0 0 0 0 0m313.344-430.08c0-58.708992-1.364992-126.292992-4.096-202.752 0 0 169.984 0 169.984 0 0 0 10.24 88.064 10.24 88.064 0 0 4.096 0 4.096 0 40.96-68.267008 105.812992-102.4 194.56-102.4 68.267008 0 123.220992 22.868992 164.864 68.608 41.643008 45.739008 62.464 113.664 62.464 203.776 0 0 0 374.784 0 374.784 0 0-196.608 0-196.608 0 0 0 0-350.208 0-350.208 0-91.476992-33.451008-137.216-100.352-137.216-47.787008 0-81.236992 24.576-100.352 73.728-4.096 8.192-6.144 24.576-6.144 49.152 0 0 0 364.544 0 364.544 0 0-198.656 0-198.656 0 0 0 0-430.08 0-430.08 0 0 0 0 0 0" />
</svg>
</div>
        </a>
      </li><li title="Follow me on Github.">
        <a class="button button--circle github-button" itemprop="sameAs" href="https://github.com/abatten" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path class="svgpath" data-index="path_0" fill="#272636" d="M0 525.2c0 223.6 143.3 413.7 343 483.5 26.9 6.8 22.8-12.4 22.8-25.4l0-88.7c-155.3 18.2-161.5-84.6-172-101.7-21.1-36-70.8-45.2-56-62.3 35.4-18.2 71.4 4.6 113.1 66.3 30.2 44.7 89.1 37.2 119 29.7 6.5-26.9 20.5-50.9 39.7-69.6C248.8 728.2 181.7 630 181.7 513.2c0-56.6 18.7-108.7 55.3-150.7-23.3-69.3 2.2-128.5 5.6-137.3 66.5-6 135.5 47.6 140.9 51.8 37.8-10.2 80.9-15.6 129.1-15.6 48.5 0 91.8 5.6 129.8 15.9 12.9-9.8 77-55.8 138.8-50.2 3.3 8.8 28.2 66.7 6.3 135 37.1 42.1 56 94.6 56 151.4 0 117-67.5 215.3-228.8 243.7 26.9 26.6 43.6 63.4 43.6 104.2l0 128.8c0.9 10.3 0 20.5 17.2 20.5C878.1 942.4 1024 750.9 1024 525.3c0-282.9-229.3-512-512-512C229.1 13.2 0 242.3 0 525.2L0 525.2z" />
</svg>
</div>
        </a>
      </li><li title="Find me on ORCID.">
        <a class="button button--circle orcid-button" itemprop="sameAs" href="https://orcid.org/0000-0001-7599-6488" target="_blank">
          <div class="icon"><i class="fab fa-orcid"></i></div>
        </a>
      </li></ul>
</div>
</div>

    </div>
</div>
</footer>
<div class="article__section-navigator clearfix"><div class="next"><span>NEXT</span><a href="/tutorials/setting_up_python_on_ozstar.html">Setting up Python on OzSTAR</a></div></div></div>

</div>

<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    $(function() {
      var $this ,$scroll;
      var $articleContent = $('.js-article-content');
      var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
      var scroll = hasSidebar ? '.js-page-main' : 'html, body';
      $scroll = $(scroll);

      $articleContent.find('.highlight').each(function() {
        $this = $(this);
        $this.attr('data-lang', $this.find('code').attr('data-lang'));
      });
      $articleContent.find('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]').each(function() {
        $this = $(this);
        $this.append($('<a class="anchor d-print-none" aria-hidden="true"></a>').html('<i class="fas fa-anchor"></i>'));
      });
      $articleContent.on('click', '.anchor', function() {
        $scroll.scrollToAnchor('#' + $(this).parent().attr('id'), 400);
      });
    });
  });
})();
</script>
</div><section class="page__comments d-print-none"></section></article><!-- start custom main bottom snippet -->

<!-- end custom main bottom snippet -->
</div>
            </div></div></div><div class="page__footer d-print-none">
<footer class="footer py-4 js-page-footer">
  <div class="main"><div itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Adam Batten"><meta itemprop="url" content="https://adambatten.com"><meta itemprop="description" content="Astrophysics PhD Student | Science Communicator"><div class="footer__author-links"><div class="author-links">
  <ul class="menu menu--nowrap menu--inline"><link itemprop="url" href="https://adambatten.com"><li title="Send me an Email.">
      <a class="button button--circle mail-button" itemprop="email" href="mailto:abatten@swin.edu.au" target="_blank">
        <i class="fas fa-envelope"></i>
      </a><li title="Follow me on Twitter.">
        <a class="button button--circle twitter-button" itemprop="sameAs" href="https://twitter.com/adamjbatten" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M1024.032 194.432c-37.664 16.704-78.176 28-120.672 33.088 43.36-26.016 76.672-67.168 92.384-116.224-40.608 24.064-85.568 41.568-133.408 50.976-38.336-40.832-92.928-66.336-153.344-66.336-116.032 0-210.08 94.048-210.08 210.08 0 16.48 1.856 32.512 5.44 47.872-174.592-8.768-329.408-92.416-433.024-219.52-18.08 31.04-28.448 67.104-28.448 105.632 0 72.896 37.088 137.184 93.472 174.88-34.432-1.088-66.816-10.528-95.168-26.272-0.032 0.864-0.032 1.76-0.032 2.656 0 101.792 72.416 186.688 168.512 205.984-17.632 4.8-36.192 7.36-55.36 7.36-13.536 0-26.688-1.312-39.52-3.776 26.72 83.456 104.32 144.192 196.256 145.888-71.904 56.352-162.496 89.92-260.928 89.92-16.96 0-33.664-0.992-50.112-2.944 92.96 59.616 203.392 94.4 322.048 94.4 386.432 0 597.728-320.128 597.728-597.76 0-9.12-0.192-18.176-0.608-27.168 41.056-29.632 76.672-66.624 104.832-108.736z" />
</svg>
</div>
        </a>
      </li><li title="Follow me on Linkedin.">
        <a class="button button--circle linkedin-button" itemprop="sameAs" href="https://www.linkedin.com/in/adamjbatten" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M260.096 155.648c0 27.307008-9.899008 50.516992-29.696 69.632-19.796992 19.115008-45.396992 28.672-76.8 28.672-30.036992 0-54.612992-9.556992-73.728-28.672-19.115008-19.115008-28.672-42.324992-28.672-69.632 0-28.672 9.556992-52.224 28.672-70.656 19.115008-18.432 44.372992-27.648 75.776-27.648 31.403008 0 56.32 9.216 74.752 27.648 18.432 18.432 28.331008 41.984 29.696 70.656 0 0 0 0 0 0m-202.752 808.96c0 0 0-632.832 0-632.832 0 0 196.608 0 196.608 0 0 0 0 632.832 0 632.832 0 0-196.608 0-196.608 0 0 0 0 0 0 0m313.344-430.08c0-58.708992-1.364992-126.292992-4.096-202.752 0 0 169.984 0 169.984 0 0 0 10.24 88.064 10.24 88.064 0 0 4.096 0 4.096 0 40.96-68.267008 105.812992-102.4 194.56-102.4 68.267008 0 123.220992 22.868992 164.864 68.608 41.643008 45.739008 62.464 113.664 62.464 203.776 0 0 0 374.784 0 374.784 0 0-196.608 0-196.608 0 0 0 0-350.208 0-350.208 0-91.476992-33.451008-137.216-100.352-137.216-47.787008 0-81.236992 24.576-100.352 73.728-4.096 8.192-6.144 24.576-6.144 49.152 0 0 0 364.544 0 364.544 0 0-198.656 0-198.656 0 0 0 0-430.08 0-430.08 0 0 0 0 0 0" />
</svg>
</div>
        </a>
      </li><li title="Follow me on Github.">
        <a class="button button--circle github-button" itemprop="sameAs" href="https://github.com/abatten" target="_blank">
          <div class="icon"><svg fill="#000000" width="24px" height="24px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path class="svgpath" data-index="path_0" fill="#272636" d="M0 525.2c0 223.6 143.3 413.7 343 483.5 26.9 6.8 22.8-12.4 22.8-25.4l0-88.7c-155.3 18.2-161.5-84.6-172-101.7-21.1-36-70.8-45.2-56-62.3 35.4-18.2 71.4 4.6 113.1 66.3 30.2 44.7 89.1 37.2 119 29.7 6.5-26.9 20.5-50.9 39.7-69.6C248.8 728.2 181.7 630 181.7 513.2c0-56.6 18.7-108.7 55.3-150.7-23.3-69.3 2.2-128.5 5.6-137.3 66.5-6 135.5 47.6 140.9 51.8 37.8-10.2 80.9-15.6 129.1-15.6 48.5 0 91.8 5.6 129.8 15.9 12.9-9.8 77-55.8 138.8-50.2 3.3 8.8 28.2 66.7 6.3 135 37.1 42.1 56 94.6 56 151.4 0 117-67.5 215.3-228.8 243.7 26.9 26.6 43.6 63.4 43.6 104.2l0 128.8c0.9 10.3 0 20.5 17.2 20.5C878.1 942.4 1024 750.9 1024 525.3c0-282.9-229.3-512-512-512C229.1 13.2 0 242.3 0 525.2L0 525.2z" />
</svg>
</div>
        </a>
      </li><li title="Find me on ORCID.">
        <a class="button button--circle orcid-button" itemprop="sameAs" href="https://orcid.org/0000-0001-7599-6488" target="_blank">
          <div class="icon"><i class="fab fa-orcid"></i></div>
        </a>
      </li></ul>
</div>
</div>
    </div><div class="site-info mt-2">
      <div>© Adam Batten 2021,
        Powered by <a title="Jekyll is a simple, blog-aware, static site generator." href="http://jekyllrb.com/">Jekyll</a> & <a
        title="TeXt is a super customizable Jekyll theme." href="https://github.com/kitian616/jekyll-TeXt-theme">TeXt Theme</a>.
      </div>
    </div>
  </div>
</footer>
</div></div>
    </div><script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $body = $('body'), $window = $(window);
    var $pageRoot = $('.js-page-root'), $pageMain = $('.js-page-main');
    var activeCount = 0;
    function modal(options) {
      var $root = this, visible, onChange, hideWhenWindowScroll = false;
      var scrollTop;
      function setOptions(options) {
        var _options = options || {};
        visible = _options.initialVisible === undefined ? false : show;
        onChange = _options.onChange;
        hideWhenWindowScroll = _options.hideWhenWindowScroll;
      }
      function init() {
        setState(visible);
      }
      function setState(isShow) {
        if (isShow === visible) {
          return;
        }
        visible = isShow;
        if (visible) {
          activeCount++;
          scrollTop = $(window).scrollTop() || $pageMain.scrollTop();
          $root.addClass('modal--show');
          $pageMain.scrollTop(scrollTop);
          activeCount === 1 && ($pageRoot.addClass('show-modal'), $body.addClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.on('scroll', hide);
          $window.on('keyup', handleKeyup);
        } else {
          activeCount > 0 && activeCount--;
          $root.removeClass('modal--show');
          $window.scrollTop(scrollTop);
          activeCount === 0 && ($pageRoot.removeClass('show-modal'), $body.removeClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.off('scroll', hide);
          $window.off('keyup', handleKeyup);
        }
        onChange && onChange(visible);
      }
      function show() {
        setState(true);
      }
      function hide() {
        setState(false);
      }
      function handleKeyup(e) {
        // Char Code: 27  ESC
        if (e.which ===  27) {
          hide();
        }
      }
      setOptions(options);
      init();
      return {
        show: show,
        hide: hide,
        $el: $root
      };
    }
    $.fn.modal = modal;
  });
})();
</script><div class="modal modal--overflow page__search-modal d-print-none js-page-search-modal"></div></div>


<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function scrollToAnchor(anchor, duration, callback) {
      var $root = this;
      $root.animate({ scrollTop: $(anchor).position().top }, duration, function() {
        window.history.replaceState(null, '', window.location.href.split('#')[0] + anchor);
        callback && callback();
      });
    }
    $.fn.scrollToAnchor = scrollToAnchor;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function affix(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroll,
        offsetBottom = 0, scrollTarget = window, scroll = window.document, disabled = false, isOverallScroller = true,
        rootTop, rootLeft, rootHeight, scrollBottom, rootBottomTop,
        hasInit = false, curState;

      function setOptions(options) {
        var _options = options || {};
        _options.offsetBottom && (offsetBottom = _options.offsetBottom);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroll && (scroll = _options.scroll);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $scrollTarget = $(scrollTarget);
        isOverallScroller = window.isOverallScroller($scrollTarget[0]);
        $scroll = $(scroll);
      }
      function preCalc() {
        top();
        rootHeight = $root.outerHeight();
        rootTop = $root.offset().top + (isOverallScroller ? 0 :  $scrollTarget.scrollTop());
        rootLeft = $root.offset().left;
      }
      function calc(needPreCalc) {
        needPreCalc && preCalc();
        scrollBottom = $scroll.outerHeight() - offsetBottom - rootHeight;
        rootBottomTop = scrollBottom - rootTop;
      }
      function top() {
        if (curState !== 'top') {
          $root.removeClass('fixed').css({
            left: 0,
            top: 0
          });
          curState = 'top';
        }
      }
      function fixed() {
        if (curState !== 'fixed') {
          $root.addClass('fixed').css({
            left: rootLeft + 'px',
            top: 0
          });
          curState = 'fixed';
        }
      }
      function bottom() {
        if (curState !== 'bottom') {
          $root.removeClass('fixed').css({
            left: 0,
            top: rootBottomTop + 'px'
          });
          curState = 'bottom';
        }
      }
      function setState() {
        var scrollTop = $scrollTarget.scrollTop();
        if (scrollTop >= rootTop && scrollTop <= scrollBottom) {
          fixed();
        } else if (scrollTop < rootTop) {
          top();
        } else {
          bottom();
        }
      }
      function init() {
        if(!hasInit) {
          var interval, timeout;
          calc(true); setState();
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState();
          });
          $window.on('resize', function() {
            disabled || (calc(true), setState());
          });
          hasInit = true;
        }
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions,
        refresh: function() {
          calc(true, { animation: false }); setState();
        }
      };
    }
    $.fn.affix = affix;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function toc(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroller, $tocUl = $('<ul class="toc toc--ellipsis"></ul>'), $tocLi, $headings, $activeLast, $activeCur,
        selectors = 'h1,h2,h3', container = 'body', scrollTarget = window, scroller = 'html, body', disabled = false,
        headingsPos, scrolling = false, hasRendered = false, hasInit = false;

      function setOptions(options) {
        var _options = options || {};
        _options.selectors && (selectors = _options.selectors);
        _options.container && (container = _options.container);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroller && (scroller = _options.scroller);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $headings = $(container).find(selectors).filter('[id]');
        $scrollTarget = $(scrollTarget);
        $scroller = $(scroller);
      }
      function calc() {
        headingsPos = [];
        $headings.each(function() {
          headingsPos.push(Math.floor($(this).position().top));
        });
      }
      function setState(element, disabled) {
        var scrollTop = $scrollTarget.scrollTop(), i;
        if (disabled || !headingsPos || headingsPos.length < 1) { return; }
        if (element) {
          $activeCur = element;
        } else {
          for (i = 0; i < headingsPos.length; i++) {
            if (scrollTop >= headingsPos[i]) {
              $activeCur = $tocLi.eq(i);
            } else {
              $activeCur || ($activeCur = $tocLi.eq(i));
              break;
            }
          }
        }
        $activeLast && $activeLast.removeClass('active');
        ($activeLast = $activeCur).addClass('active');
      }
      function render() {
        if(!hasRendered) {
          $root.append($tocUl);
          $headings.each(function() {
            var $this = $(this);
            $tocUl.append($('<li></li>').addClass('toc-' + $this.prop('tagName').toLowerCase())
              .append($('<a></a>').text($this.text()).attr('href', '#' + $this.prop('id'))));
          });
          $tocLi = $tocUl.children('li');
          $tocUl.on('click', 'a', function(e) {
            e.preventDefault();
            var $this = $(this);
            scrolling = true;
            setState($this.parent());
            $scroller.scrollToAnchor($this.attr('href'), 400, function() {
              scrolling = false;
            });
          });
        }
        hasRendered = true;
      }
      function init() {
        var interval, timeout;
        if(!hasInit) {
          render(); calc(); setState(null, scrolling);
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState(null, scrolling);
          });
          $window.on('resize', window.throttle(function() {
            if (!disabled) {
              render(); calc(); setState(null, scrolling);
            }
          }, 100));
        }
        hasInit = true;
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions
      };
    }
    $.fn.toc = toc;
  });
})();
/*(function () {

})();*/
</script><script>
  /* toc must before affix, since affix need to konw toc' height. */(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  var TOC_SELECTOR = window.TEXT_VARIABLES.site.toc.selectors;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window);
    var $articleContent = $('.js-article-content');
    var $tocRoot = $('.js-toc-root'), $col2 = $('.js-col-aside');
    var toc;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
    var hasToc = $articleContent.find(TOC_SELECTOR).length > 0;

    function disabled() {
      return $col2.css('display') === 'none' || !hasToc;
    }

    tocDisabled = disabled();

    toc = $tocRoot.toc({
      selectors: TOC_SELECTOR,
      container: $articleContent,
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      tocDisabled = disabled();
      toc && toc.setOptions({
        disabled: tocDisabled
      });
    }, 100));

  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window), $pageFooter = $('.js-page-footer');
    var $pageAside = $('.js-page-aside');
    var affix;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');

    affix = $pageAside.affix({
      offsetBottom: $pageFooter.outerHeight(),
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      scroll: hasSidebar ? $('.js-page-main').children() : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      affix && affix.setOptions({
        disabled: tocDisabled
      });
    }, 100));

    window.pageAsideAffix = affix;
  });
})();
</script><script type="text/x-mathjax-config">
	var _config = { tex2jax: {
		inlineMath: [['$','$'], ['\\(','\\)']]
	}};MathJax.Hub.Config(_config);
</script>
<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML" async></script>

    </div>
    <script>(function () {
  var $root = document.getElementsByClassName('root')[0];
  if (window.hasEvent('touchstart')) {
    $root.dataset.isTouch = true;
    document.addEventListener('touchstart', function(){}, false);
  }
})();
</script>
  </body>
</html>

